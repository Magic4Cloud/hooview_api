<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hooview.api.dao.InfoCommentDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.hooview.api.entity.InfoCommentEntity" id="infoCommentMap">
        <result property="infoCommentId" column="info_comment_id"/>
        <result property="financeInfoId" column="finance_info_id"/>
        <result property="comment" column="comment"/>
        <result property="userId" column="user_id"/>
        <result property="createTime" column="create_time"/>
        <result property="praiseNum" column="praise_num"/>
    </resultMap>

	<select id="queryObject" resultType="com.hooview.api.entity.InfoCommentEntity">
		select * from tb_info_comment where info_comment_id = #{value}
	</select>

	<select id="queryCommentList" resultType="com.hooview.api.dto.CommentDTO">
		SELECT ic.info_comment_id,ic.`comment`,DATE_FORMAT(ic.create_time,'%Y-%m-%d %H:%i:%S') as create_time,ic.praise_num,u.nickname,u.head_url
		FROM tb_info_comment ic,sys_user u
		WHERE ic.user_id=u.user_id and ic.finance_info_id= #{financeInfoId}
        <choose>
            <when test="sidx != null and sidx.trim() != ''">
                order by ${sidx} ${order}
            </when>
			<otherwise>
                order by ic.praise_num desc
			</otherwise>
        </choose>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
	</select>
	
 	<select id="queryTotal" resultType="int">
		select count(*) from tb_info_comment WHERE finance_info_id = #{financeInfoId}
	</select>
	 
	<insert id="save" parameterType="com.hooview.api.entity.InfoCommentEntity" useGeneratedKeys="true" keyProperty="infoCommentId">
		insert into tb_info_comment
		(
			`finance_info_id`, 
			`comment`, 
			`user_id`, 
			`create_time`, 
			`praise_num`
		)
		values
		(
			#{financeInfoId}, 
			#{comment}, 
			#{userId}, 
			#{createTime}, 
			#{praiseNum}
		)
	</insert>
	 
	<update id="update" parameterType="com.hooview.api.entity.InfoCommentEntity">
		update tb_info_comment 
		<set>
			<if test="financeInfoId != null">`finance_info_id` = #{financeInfoId}, </if>
			<if test="comment != null">`comment` = #{comment}, </if>
			<if test="userId != null">`user_id` = #{userId}, </if>
			<if test="createTime != null">`create_time` = #{createTime}, </if>
			<if test="praiseNum != null">`praise_num` = #{praiseNum}</if>
		</set>
		where info_comment_id = #{infoCommentId}
	</update>

	<update id="commentPraise" parameterType="com.hooview.api.entity.InfoCommentEntity">
		update tb_info_comment set `praise_num` = praise_num + #{praiseNum} where info_comment_id = #{infoCommentId}
	</update>

	<insert id="comment" parameterType="com.hooview.api.entity.InfoCommentEntity">
		insert into tb_info_comment
		(
		`finance_info_id`,
		`comment`,
		`user_id`,
		`create_time`
		)
		values
		(
		#{financeInfoId},
		#{comment},
		#{userId},
		now()
		)
	</insert>
	
	<delete id="delete">
		delete from tb_info_comment where info_comment_id = #{value}
	</delete>
	
	<delete id="deleteBatch">
		delete from tb_info_comment where info_comment_id in 
		<foreach item="infoCommentId" collection="array" open="(" separator="," close=")">
			#{infoCommentId}
		</foreach>
	</delete>

</mapper>